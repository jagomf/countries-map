!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@jagomf/countrieslist")):"function"==typeof define&&define.amd?define("countries-map",["exports","@angular/core","@angular/common","@jagomf/countrieslist"],t):t((e=e||self)["countries-map"]={},e.ng.core,e.ng.common,e.countrieslist)}(this,(function(e,t,o,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function r(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i}function a(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,a=o.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return i}var i=function(){function e(e){this.googleScriptLoadingNotifier=new t.EventEmitter,this.googleScriptIsLoading=!1,this.localeId=e}var o,n;return e.prototype.load=function(e){var t=this;return new Promise((function(o,n){t.loadGoogleChartsScript().then((function(){var n={packages:["geochart"],language:t.localeId,callback:o};e&&(n.mapsApiKey=e),google.charts.load("45.2",n)})).catch((function(e){return n()}))}))},e.prototype.loadGoogleChartsScript=function(){var e=this;return new Promise((function(t,o){if("undefined"!=typeof google&&google.charts)t();else if(e.googleScriptIsLoading)e.googleScriptLoadingNotifier.subscribe((function(e){e?t():o()}));else{e.googleScriptIsLoading=!0;var n=document.createElement("script");n.type="text/javascript",n.src="https://www.gstatic.com/charts/loader.js",n.async=!0,n.defer=!0,n.onload=function(){e.googleScriptIsLoading=!1,e.googleScriptLoadingNotifier.emit(!0),t()},n.onerror=function(){e.googleScriptIsLoading=!1,e.googleScriptLoadingNotifier.emit(!1),o()},document.getElementsByTagName("head")[0].appendChild(n)}}))},e.ctorParameters=function(){return[{type:String,decorators:[{type:t.Inject,args:[t.LOCALE_ID]}]}]},e=r([t.Injectable(),(o=0,n=t.Inject(t.LOCALE_ID),function(e,t){n(e,t,o)})],e)}();(e.CharErrorCode||(e.CharErrorCode={})).loading="loading";var l=function(e){return n.en[e]},c=function(){function o(e,o,n){this.cdRef=e,this.el=o,this.loaderService=n,this.countryLabel="Country",this.valueLabel="Value",this.showCaption=!0,this.captionBelow=!0,this.autoResize=!1,this.minValue=0,this.minColor="white",this.maxColor="red",this.backgroundColor="white",this.noDataColor="#CFCFCF",this.exceptionColor="#FFEE58",this.chartReady=new t.EventEmitter,this.chartError=new t.EventEmitter,this.chartSelect=new t.EventEmitter,this.selection=null,this.innerLoading=!0,this.el=o,this.loaderService=n}return Object.defineProperty(o.prototype,"loading",{get:function(){return this.innerLoading},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionValue",{get:function(){return this.data[this.selection.countryId].value},enumerable:!0,configurable:!0}),o.prototype.screenSizeChanged=function(){if(!this.loading&&this.autoResize){var e=this.mapContent.nativeElement;e.style.setProperty("height",e.clientWidth*this.proportion+"px"),this.redraw()}},o.prototype.getExtraSelected=function(e){var t=this.data[e].extra;return t&&Object.keys(t).map((function(e){return{key:e,val:t[e]}}))},o.prototype.selectCountry=function(e){this.selection=e?{countryId:e,countryName:l(e),extra:this.getExtraSelected(e)}:null,this.cdRef.detectChanges()},o.prototype.processInputData=function(){this.googleData=Object.entries(this.data).reduce((function(e,t){var o=a(t,2),n=o[0],r=o[1].value;return e.push([n,null===r?null:r?+r.toString():0]),e}),[["Country","Value"]])},o.prototype.ngOnChanges=function(t){var o=this;if(t.data){if(!this.data)return;var n={colorAxis:{colors:[this.minColor,this.maxColor],minValue:Number.isInteger(this.minValue)?this.minValue:void 0,maxValue:Number.isInteger(this.maxValue)?this.maxValue:void 0},datalessRegionColor:this.noDataColor,backgroundColor:this.backgroundColor,defaultColor:this.exceptionColor,legend:this.showCaption,tooltip:{trigger:"none"}};this.loaderService.load(this.apiKey).then((function(){o.processInputData(),o.wrapper=new google.visualization.ChartWrapper({chartType:"GeoChart",dataTable:o.googleData,options:Object.assign(n,o.options)}),o.registerChartWrapperEvents(),o.redraw();var e=o.el.nativeElement;o.proportion=e.clientHeight/e.clientWidth}),(function(){o.onCharterror({id:e.CharErrorCode.loading,message:"Could not load"})}))}},o.prototype.redraw=function(){this.wrapper.draw(this.el.nativeElement.querySelector("div.cm-map-content"))},o.prototype.onChartReady=function(){this.innerLoading=!1,this.chartReady.emit()},o.prototype.onCharterror=function(e){this.chartError.emit(e)},o.prototype.onMapSelect=function(){var e={selected:!1,value:null,country:null},t=this.wrapper.visualization.getSelection();if(t.length>0){var o=t[0].row,n=this.wrapper.getDataTable();e.selected=!0,e.value=n.getValue(o,1),e.country=n.getValue(o,0),this.selectCountry(e.country)}else this.selectCountry(null);this.chartSelect.emit(e)},o.prototype.registerChartWrapperEvents=function(){var e=google.visualization.events.addListener;e(this.wrapper,"ready",this.onChartReady.bind(this)),e(this.wrapper,"error",this.onCharterror.bind(this)),e(this.wrapper,"select",this.onMapSelect.bind(this))},o.prototype.ngOnDestroy=function(){var e=google.visualization.events.removeListener;e("ready"),e("error"),e("select")},o.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:t.ElementRef},{type:i}]},r([t.Input()],o.prototype,"data",void 0),r([t.Input()],o.prototype,"apiKey",void 0),r([t.Input()],o.prototype,"options",void 0),r([t.Input()],o.prototype,"countryLabel",void 0),r([t.Input()],o.prototype,"valueLabel",void 0),r([t.Input()],o.prototype,"showCaption",void 0),r([t.Input()],o.prototype,"captionBelow",void 0),r([t.Input()],o.prototype,"autoResize",void 0),r([t.Input()],o.prototype,"minValue",void 0),r([t.Input()],o.prototype,"maxValue",void 0),r([t.Input()],o.prototype,"minColor",void 0),r([t.Input()],o.prototype,"maxColor",void 0),r([t.Input()],o.prototype,"backgroundColor",void 0),r([t.Input()],o.prototype,"noDataColor",void 0),r([t.Input()],o.prototype,"exceptionColor",void 0),r([t.Output()],o.prototype,"chartReady",void 0),r([t.Output()],o.prototype,"chartError",void 0),r([t.Output()],o.prototype,"chartSelect",void 0),r([t.ViewChild("mapContent",{static:!1})],o.prototype,"mapContent",void 0),r([t.HostListener("window:deviceorientation"),t.HostListener("window:resize")],o.prototype,"screenSizeChanged",null),o=r([t.Component({selector:"countries-map",changeDetection:t.ChangeDetectionStrategy.OnPush,template:'<div class="major-block loading" *ngIf="loading"><span class="text">Loading map...</span></div>\r\n\r\n<div class="major-block cm-map-content" #mapContent [ngClass]="{\'goes-first\': captionBelow}"></div>\r\n\r\n<div class="major-block cm-caption-container" [ngClass]="{\'goes-first\': !captionBelow}"\r\n  *ngIf="!loading && showCaption">\r\n  <div class="cm-simple-caption">\r\n    <div class="cm-country-label">\r\n      <span class="cm-default-label" *ngIf="!selection">{{countryLabel}}</span>\r\n      <span class="cm-country-name" *ngIf="selection">{{selection?.countryName}}</span>\r\n    </div>\r\n    <div class="cm-value-label">\r\n      <span class="cm-value-text"\r\n        [ngClass]="{\'has-value\': selection}">{{valueLabel}}<span *ngIf="selection">: </span></span>\r\n      <span class="cm-value-content" *ngIf="selection">{{selectionValue}}</span>\r\n    </div>\r\n  </div>\r\n  <div class="cm-extended-caption" *ngIf="selection?.extra && selection?.extra.length > 0">\r\n    <div *ngFor="let item of selection?.extra" class="cm-extended-item">\r\n      <span class="cm-extended-label">{{item.key}}</span>:\r\n      <span class="cm-extended-value">{{item.val}}</span>\r\n    </div>\r\n  </div>\r\n</div>\r\n',styles:[":host{display:flex;flex-flow:column nowrap;justify-content:space-between;align-items:stretch;align-content:stretch}.major-block.loading{flex:0 1 auto;align-self:center}.loading .text{font-style:italic;font-family:sans-serif;color:gray}.major-block.cm-map-content{flex:0 1 auto}.major-block.goes-first{order:0}.major-block:not(.goes-first){order:1}.major-block.cm-caption-container{flex:0 1 auto;display:flex;flex-flow:column nowrap;justify-content:space-between}.cm-simple-caption{display:flex;flex-flow:row nowrap;justify-content:space-between}.cm-country-label{flex:0 1 auto;align-self:flex-start}.cm-value-label{flex:0 1 auto;align-self:flex-end}.cm-country-label,.cm-value-label{flex:0 1 auto}.cm-country-label .cm-country-name{font-weight:700}.cm-country-label .cm-country-name,.cm-value-label .cm-value-text{color:#333}.cm-country-label .cm-default-label,.cm-value-label .cm-value-text:not(.has-value){font-style:italic;color:#777}.cm-extended-caption{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));grid-gap:5px}.cm-extended-item{margin:5px auto}.cm-extended-item .cm-extended-label{font-weight:700}"]})],o)}(),s=function(){function e(){}return e=r([t.NgModule({imports:[o.CommonModule],declarations:[c],entryComponents:[c],providers:[i],exports:[c]})],e)}();e.CountriesMapComponent=c,e.CountriesMapModule=s,e.ɵa=i,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=countries-map.umd.min.js.map