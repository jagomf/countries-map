!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@jagomf/countrieslist"),require("@angular/common")):"function"==typeof define&&define.amd?define("countries-map",["exports","@angular/core","@jagomf/countrieslist","@angular/common"],t):t(e["countries-map"]={},e.ng.core,e.countrieslist,e.ng.common)}(this,function(e,o,n,t){"use strict";var a=function(){function e(e){this.googleScriptLoadingNotifier=new o.EventEmitter,this.googleScriptIsLoading=!1,this.localeId=e}return e.prototype.load=function(n){var a=this;return new Promise(function(t,o){a.loadGoogleChartsScript().then(function(){var e={packages:["geochart"],language:a.localeId,callback:t};n&&(e.mapsApiKey=n),google.charts.load("45.2",e)})["catch"](function(e){return o()})})},e.prototype.loadGoogleChartsScript=function(){var n=this;return new Promise(function(t,o){if("undefined"!=typeof google&&google.charts)t();else if(n.googleScriptIsLoading)n.googleScriptLoadingNotifier.subscribe(function(e){e?t():o()});else{n.googleScriptIsLoading=!0;var e=document.createElement("script");e.type="text/javascript",e.src="https://www.gstatic.com/charts/loader.js",e.async=!0,e.defer=!0,e.onload=function(){n.googleScriptIsLoading=!1,n.googleScriptLoadingNotifier.emit(!0),t()},e.onerror=function(){n.googleScriptIsLoading=!1,n.googleScriptLoadingNotifier.emit(!1),o()},document.getElementsByTagName("head")[0].appendChild(e)}})},e}();a.decorators=[{type:o.Injectable}],a.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[o.LOCALE_ID]}]}]};var i=function(){function e(e,t){this.el=e,this.loaderService=t,this.countryLabel="Country",this.valueLabel="Value",this.showCaption=!0,this.captionBelow=!0,this.minValue=0,this.minColor="white",this.maxColor="red",this.noDataColor="#CFCFCF",this.exceptionColor="#FFEE58",this.selection=null,this.loading=!0,this.el=e,this.loaderService=t,this.chartSelect=new o.EventEmitter,this.chartReady=new o.EventEmitter,this.chartError=new o.EventEmitter}return Object.defineProperty(e.prototype,"selectionValue",{get:function(){return this.data[this.selection.countryId].value},enumerable:!0,configurable:!0}),e.prototype.getExtraSelected=function(e){var t=this.data[e].extra;return t&&Object.keys(t).map(function(e){return{key:e,val:t[e]}})},e.prototype.selectCountry=function(e){var t;this.selection=e?{countryId:e,countryName:(t=e,n.en[t]),extra:this.getExtraSelected(e)}:null},e.prototype.processInputData=function(){var n=this;this.googleData=Object.keys(this.data).reduce(function(e,t){var o=n.data[t].value;return e.push([t,o]),e},[["Country","Value"]])},e.prototype.ngOnChanges=function(e){var t=this;if(e.data){if(!this.data)return;var o={colorAxis:{colors:[this.minColor,this.maxColor],minValue:Number.isInteger(this.minValue)?this.minValue:undefined,maxValue:Number.isInteger(this.maxValue)?this.maxValue:undefined},datalessRegionColor:this.noDataColor,defaultColor:this.exceptionColor,legend:this.showCaption,tooltip:{trigger:"none"}};this.loaderService.load(this.apiKey).then(function(){t.processInputData(),t.wrapper=new google.visualization.ChartWrapper({chartType:"GeoChart",dataTable:t.googleData,options:Object.assign(o,t.options)}),t.registerChartWrapperEvents(),t.redraw()})}},e.prototype.redraw=function(){this.wrapper.draw(this.el.nativeElement.querySelector("div.cm-map-content"))},e.prototype.onChartReady=function(){this.loading=!1,this.chartReady.emit()},e.prototype.onCharterror=function(e){this.chartError.emit(e)},e.prototype.onMapSelect=function(){var e={selected:!1,value:null,country:null},t=this.wrapper.visualization.getSelection();if(0<t.length){var o=t[0].row,n=this.wrapper.getDataTable();e.selected=!0,e.value=n.getValue(o,1),e.country=n.getValue(o,0),this.selectCountry(e.country)}else this.selectCountry(null);this.chartSelect.emit(e)},e.prototype.registerChartWrapperEvents=function(){var e=google.visualization.events.addListener;e(this.wrapper,"ready",this.onChartReady.bind(this)),e(this.wrapper,"error",this.onCharterror.bind(this)),e(this.wrapper,"select",this.onMapSelect.bind(this))},e}();i.decorators=[{type:o.Component,args:[{selector:"countries-map",template:'<div class="major-block loading" *ngIf="loading"><span class="text">Loading map...</span></div>\n\n<div class="major-block cm-map-content" [ngClass]="{\'goes-first\': captionBelow}"></div>\n\n<div class="major-block cm-caption-container" [ngClass]="{\'goes-first\': !captionBelow}"\n  *ngIf="!loading && showCaption">\n  <div class="cm-simple-caption">\n    <div class="cm-country-label">\n      <span class="cm-default-label" *ngIf="!selection">{{countryLabel}}</span>\n      <span class="cm-country-name" *ngIf="selection">{{selection?.countryName}}</span>\n    </div>\n    <div class="cm-value-label">\n      <span class="cm-value-text"\n        [ngClass]="{\'has-value\': selection}">{{valueLabel}}<span *ngIf="selection">: </span></span>\n      <span class="cm-value-content" *ngIf="selection">{{selectionValue}}</span>\n    </div>\n  </div>\n  <div class="cm-extended-caption" *ngIf="selection?.extra && selection?.extra.length > 0">\n    <div *ngFor="let item of selection?.extra" class="cm-extended-item">\n      <span class="cm-extended-label">{{item.key}}</span>:\n      <span class="cm-extended-value">{{item.val}}</span>\n    </div>\n  </div>\n</div>\n',styles:[":host{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-ms-flex-line-pack:stretch;align-content:stretch}.major-block.loading{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;-ms-flex-item-align:center;align-self:center}.loading .text{font-style:italic;font-family:sans-serif;color:gray}.major-block.cm-map-content{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto}.major-block.goes-first{-webkit-box-ordinal-group:1;-ms-flex-order:0;order:0}.major-block:not(.goes-first){-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}.major-block.cm-caption-container{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.cm-simple-caption{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.cm-country-label{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;-ms-flex-item-align:start;align-self:flex-start}.cm-value-label{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;-ms-flex-item-align:end;align-self:flex-end}.cm-country-label,.cm-value-label{-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto}.cm-country-label .cm-country-name{font-weight:700}.cm-country-label .cm-country-name,.cm-value-label .cm-value-text{color:#333}.cm-country-label .cm-default-label,.cm-value-label .cm-value-text:not(.has-value){font-style:italic;color:#777}.cm-extended-caption{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));grid-gap:5px}.cm-extended-item{margin:5px auto}.cm-extended-item .cm-extended-label{font-weight:700}"]}]}],i.ctorParameters=function(){return[{type:o.ElementRef},{type:a}]},i.propDecorators={data:[{type:o.Input}],apiKey:[{type:o.Input}],options:[{type:o.Input}],countryLabel:[{type:o.Input}],valueLabel:[{type:o.Input}],showCaption:[{type:o.Input}],captionBelow:[{type:o.Input}],minValue:[{type:o.Input}],maxValue:[{type:o.Input}],minColor:[{type:o.Input}],maxColor:[{type:o.Input}],noDataColor:[{type:o.Input}],exceptionColor:[{type:o.Input}],chartReady:[{type:o.Output}],chartError:[{type:o.Output}],chartSelect:[{type:o.Output}]};var r=function(){};r.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule],declarations:[i],entryComponents:[i],providers:[a],exports:[i]}]}],e.CountriesMapModule=r,e.CountriesMapComponent=i,e.Éµa=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=countries-map.umd.min.js.map
